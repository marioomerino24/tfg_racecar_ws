<launch>
  <!-- ===== Args ===== -->
  <arg name="world" default="$(find racecar_sim_gazebo)/worlds/racecar_cones.world"/>
  <param name="use_sim_time" value="true"/>

  <!-- ===== 1) Sim + percepción (tu bringup de Gazebo con LIDAR y pipeline de percepción) ===== -->
  <!-- Este launch debe spawnear el coche en el mundo de conos y publicar LIDAR + nodos de percepción. -->
  <include file="$(find racecar_sim_gazebo)/launch/racecar_with_cones_perception.launch">
    <arg name="world_name" value="$(arg world)"/>
  </include>
  <!-- Publica la TF odom->base_link a partir de /vesc/odom -->
  <node pkg="racecar_sim_gazebo" type="odom_to_tf.py" name="odom_to_tf" output="screen">
    <param name="odom_topic" value="/vesc/odom"/>     <!-- ajusta si tu tópico es otro -->
    <param name="odom_frame" value="odom"/>
    <param name="base_frame" value="base_link"/>
  </node>

  <!-- ===== 2) Geometría de pista (pairing L/R, midpoints, centerline/resample, markers) ===== -->
  <!-- Usa tus scripts + configs de racecar_track_geometry -->
  <!--<include file="$(find racecar_track_geometry)/launch/track_geometry.launch"/>-->

  <!-- ===== 3) Selector Pure Pursuit (solo cálculo P*, Ld, kappa; SIN publicar control) ===== -->
  <!--<include file="$(find racecar_pure_pursuit)/launch/pure_pursuit.launch"/ -->

  <!-- ===== 4) Teleoperador por teclado (control humano del vehículo) ===== -->
  <!-- Tu script original publica en /vesc/ackermann_cmd_mux/input/teleop; lo llevamos al bus común /ackermann_cmd -->
  <!--<node pkg="racecar_sim_control" type="keyboard_teleop.py" name="keyboard_teleop" output="screen">
    <remap from="/vesc/ackermann_cmd_mux/input/teleop" to="/ackermann_cmd"/>
  </node>-->
   

  <!-- ===== 5) RViz (visual debugging: TF, LIDAR, odom pose, cones, pairing, midpoints, centerline, target) ===== -->
  <!-- Usa el layout que ya traes; fijo 'odom' para coherencia con gazebo_odometry -->
  <node pkg="rviz" type="rviz" name="rviz"
        args="-d $(find racecar_track_geometry)/rviz/cone_perception.rviz" />
</launch>
